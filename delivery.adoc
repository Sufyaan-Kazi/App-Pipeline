== Continuous Deployment

In this example we will create a continuous deployment pipleine using CloudBee's Jenkins, Artifactory and Pivotal Cloud Foundry

=== 1. Create Jenkins Job

Choose New Item and select FreeStyle project. Include a name for the project.

image:./images/Jenkins_New_Job.png[Jenkins Job]

=== 2. Configure Source Code Management 

Choose Git and provide a public repo URL 

NOTE: private repos work assuming credentials are configured

image:./images/PCF_Map_SCM.png[Source Code Management]

=== 3. Set build trigger

In this example we'll to poll the repo for changes very frequently to watch the pipeline run.

image:./images/PCF_Map_Poll.png[Poll SCM]

=== 4. Build Environment

Set the build environment to use Generic-Artifactory integration. We'll use Artifactory as the true for our deployment 
artifacts. We also control the number of artifacts we keep by discarding old builds.

image:./images/PCF_Map_Artifactory_Store.png[Build Environment]

=== 5. Trigger parameterized deployment

Upon completiong the deployment artifact and storing it in Artifactory, we will call a downstream Jenkins job to deploy 
our application into our development environment in Pivotal Cloud Foundry. In this example we will call separate jobs 
to deploy into a on-premise and off-premise Cloud Foundry. 

We also pass and required parameters for downstream jobs, in this case the build number for the deployment artifact. You
can also use other deployment variables based on your design.

image:./images/PCF_Map_Post_Build_Scripts.png[Parameterized Builds]

=== 6. Create a deployment job

The first Jenkin's job build and stored the deployment aritfact in Artifactory. This job leverages the CloudBee's CF CLI
to deploy our application into Pivotal Cloud Foundry. The job accepts a couple of parameters
. The Build Number from the previous upstream job.
. The domain name of the Cloud Foundry App Foundation.

The build number is used in the application name and route name when the application is pushed. This provides a quick way
to determine which build you are working with in the environment. You can use other identifiers from the build system like
hash commits.

The doamin name is provided to make route maintenance in Cloud Foundry. When the application is pushed it is given a unique 
route in Cloud Foundry. This route is the mechanism for accessing the application, its the URL, and in this example it follows
a naming convention of "map-build-XX".piv-demo.com.

As a convenience, we also map the route map-dev.piv-demo.com to the latest deployed artifact making it easy to access in
different environments. Routes in Cloud Foudnry are very powerful and make the platfrom very easy to change.
application 
